version: '3.4'

services:
  ddpm:
    # Using a Dockerfile is optional, but included for completeness.
    build:
      context: ../
      dockerfile: .devcontainer/Dockerfile

    volumes:
      # This is where VS Code should expect to find your project's source code and the value of "workspaceFolder" in .devcontainer/devcontainer.json
      - ..:/workspace
      - ../../human36m:/dataset/human36m
      #- ~/.aws/:/root/.aws/

      # Uncomment the next line to use Docker from inside the container. See https://aka.ms/vscode-remote/samples/docker-from-docker-compose for details.
      - /var/run/docker.sock:/var/run/docker.sock

    command: nvidia-smi
    runtime: nvidia  # This enables GPU access for the service
    ipc: host
    privileged: true
    deploy:
      resources:
        reservations:
          devices:
          - driver: nvidia
            device_ids: ['0']
            capabilities: [gpu]
    
    container_name: ddpm_container

    # Overrides default command so things don't shut down after the process ends.
    # command: /bin/sh -c "while sleep 1000; do :; done"

    # Runs app on the same network as the service container, allows "forwardPorts" in devcontainer.json function.